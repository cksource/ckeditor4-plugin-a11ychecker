!function(){"use strict";function t(t,e,n){return Math.max(t,Math.min(e,n))}CKEDITOR.plugins.add("balloonpanel",{onLoad:function(){CKEDITOR.document.appendStyleSheet(this.path+"skins/moono/balloonpanel.css")}}),CKEDITOR.ui.balloonPanel=function(t,e){this.editor=t,CKEDITOR.tools.extend(this,{width:360,height:"auto",triangleWidth:20,triangleHeight:20,triangleMinDistance:40},e,!0),this.templates={};for(var n in this.templateDefinitions)this.templates[n]=new CKEDITOR.template(this.templateDefinitions[n]);this.parts={},this.focusables={},this.showListeners={},this.activeShowListeners={},this.rect={visible:!1},this.build(),t.on("destroy",function(){this.destroy()},this)},CKEDITOR.ui.balloonPanel.prototype={templateDefinitions:{panel:'<div class="cke {id} cke_reset_all cke_chrome cke_balloon cke_editor_{name} cke_{langDir} '+CKEDITOR.env.cssClass+'" dir="{langDir}" title="'+(CKEDITOR.env.gecko?" ":"")+'" lang="{langCode}" role="dialog" style="{style}" tabindex="-1" aria-labelledby="cke_{name}_arialbl"></div>',content:'<div class="cke_balloon_content">{content}</div>',title:'<div class="cke_balloon_title" role="presentation">{title}</div>',close:'<a class="cke_balloon_close_button" href="javascript:void(0)" title="Close" role="button" tabindex="-1"><span class="cke_label">X</span></a>',triangleOuter:'<span class="cke_balloon_triangle cke_balloon_triangle_outer"></span>',triangleInner:'<span class="cke_balloon_triangle cke_balloon_triangle_inner">&#8203;</span>'},build:function(){var t=this.editor;this.parts={title:CKEDITOR.dom.element.createFromHtml(this.templates.title.output({title:this.title})),close:CKEDITOR.dom.element.createFromHtml(this.templates.close.output()),panel:CKEDITOR.dom.element.createFromHtml(this.templates.panel.output({id:t.id,langDir:t.lang.dir,langCode:t.langCode,name:t.name,style:"display:none;",voiceLabel:t.lang.editorPanel+", "+t.name})),content:CKEDITOR.dom.element.createFromHtml(this.templates.content.output({content:this.content||""})),triangleOuter:CKEDITOR.dom.element.createFromHtml(this.templates.triangleOuter.output()),triangleInner:CKEDITOR.dom.element.createFromHtml(this.templates.triangleInner.output())},this.parts.panel.append(this.parts.title,1),this.parts.panel.append(this.parts.close,1),this.parts.panel.append(this.parts.triangleOuter),this.parts.panel.append(this.parts.content),this.parts.triangleOuter.append(this.parts.triangleInner),this.registerFocusable(this.parts.panel),this.registerFocusable(this.parts.close),this.parts.title.unselectable(),this.parts.close.unselectable(),CKEDITOR.document.getBody().append(this.parts.panel),this.resize(this.width,this.height),this.on("show",this.activateShowListeners,this),this.on("hide",this.deactivateShowListeners,this)},show:function(){this.rect.visible||(this.rect.visible=!0,this.parts.panel.show(),this.fire("show"))},hide:function(){this.rect.visible&&(this.rect.visible=!1,this.parts.panel.hide(),this.fire("hide"))},blur:function(){this.editor.focus()},move:function(t,e){this.rect.left=e,this.rect.top=t,this.parts.panel.setStyles({left:CKEDITOR.tools.cssLength(e),top:CKEDITOR.tools.cssLength(t)})},attach:function(){function t(t,e){var n=Math.max(0,Math.min(t.right,e.right)-Math.max(t.left,e.left)),i=Math.max(0,Math.min(t.bottom,e.bottom)-Math.max(t.top,e.top));return n*i}function e(t,e,n,i){var s={top:t,left:e};return s.right=s.left+n,s.bottom=s.top+i,s}function n(t){var e,n=t.getClientRect(),a=i.getScrollPosition();return r||t.equals(s)?(n.top=n.top+a.y,n.left=n.left+a.x,n.right=n.left+n.width,n.bottom=n.top+n.height):(e=s.getClientRect(),n.top=e.top+n.top+a.y,n.left=e.left+n.left+a.x,n.right=n.left+n.width,n.bottom=n.top+n.height),n}var i,s,a,r,o={right:"left",top:"bottom",topLeft:"bottomLeft",topRight:"bottomRight",bottom:"top",bottomLeft:"topLeft",bottomRight:"topRight",left:"right"};return function(c,u){this.show(),this.fire("attach"),i=CKEDITOR.document.getWindow(),s=this.editor.window.getFrame(),a=this.editor.editable(),r=a.isInline();var l=this.getWidth(),d=this.getHeight(),h=n(c),p=n(r?a:s),f=i.getViewPaneSize(),g=i.getScrollPosition(),m={top:Math.max(p.top,g.y),left:Math.max(p.left,g.x),right:Math.min(p.right,f.width+g.x),bottom:Math.min(p.bottom,f.height+g.y)};r&&(m=this._getViewPaneRect(i),m.right+=this.triangleWidth,m.bottom+=this.triangleHeight),this._adjustElementRect(h,r?m:p);var v,b,y,x=l*d,w=this._getAlignments(h,l,d);for(var C in w){if(b=e(w[C].top,w[C].left,l,d),y=w[C].areaDifference=x-t(b,m),0===y){v=C;break}v||(v=C),y<w[v].areaDifference&&(v=C)}this.move(w[v].top,w[v].left),v=v.split(" "),this.setTriangle(o[v[0]],v[1]),u!==!1&&(u||this.parts.panel).focus()}}(),resize:function(t,e){this.rect.width=t,this.rect.height=e,this.parts.panel.setStyles({width:CKEDITOR.tools.cssLength(t),height:CKEDITOR.tools.cssLength(e)})},getWidth:function(){return"auto"===this.rect.width?this.parts.panel.getClientRect().width:this.rect.width},getHeight:function(){return"auto"===this.rect.height?this.parts.panel.getClientRect().height:this.rect.height},setTriangle:function(t,e){var n=this.parts.triangleOuter,i=this.parts.triangleInner;this.triangleSide&&(n.removeClass("cke_balloon_triangle_"+this.triangleSide),n.removeClass("cke_balloon_triangle_align_"+this.triangleAlign),i.removeClass("cke_balloon_triangle_"+this.triangleSide)),this.triangleSide=t,this.triangleAlign=e,n.addClass("cke_balloon_triangle_"+t),n.addClass("cke_balloon_triangle_align_"+e),i.addClass("cke_balloon_triangle_"+t)},registerFocusable:function(t){this.editor.focusManager.add(t),this.focusables[t.getUniqueId()]=t},deregisterFocusable:function(t){this.editor.focusManager.remove(t),delete this.focusables[t.getUniqueId()]},addShowListener:function(t){var e=CKEDITOR.tools.getNextNumber();this.showListeners[e]=t,this.rect.visible&&this.activateShowListener(e);var n=this;return{removeListener:function(){n.removeShowListener(e)}}},removeShowListener:function(t){this.deactivateShowListener(t),delete this.showListeners[t]},activateShowListener:function(t){this.activeShowListeners[t]=this.showListeners[t].call(this)},deactivateShowListener:function(t){this.activeShowListeners[t]&&this.activeShowListeners[t].removeListener(),delete this.activeShowListeners[t]},activateShowListeners:function(){for(var t in this.showListeners)this.activateShowListener(t)},deactivateShowListeners:function(){for(var t in this.activeShowListeners)this.deactivateShowListener(t)},destroy:function(){this.deactivateShowListeners(),this.parts.panel.remove()},setTitle:function(t){this.parts.title.setHtml(t)},_getAlignments:function(t,e,n){return{"right vcenter":{top:t.top+t.height/2-n/2,left:t.right+this.triangleWidth},"left vcenter":{top:t.top+t.height/2-n/2,left:t.left-e-this.triangleWidth},"top hcenter":{top:t.top-n-this.triangleHeight,left:t.left+t.width/2-e/2},"top left":{top:t.top-n-this.triangleHeight,left:t.left+t.width/2-this.triangleMinDistance},"top right":{top:t.top-n-this.triangleHeight,left:t.right-t.width/2-e+this.triangleMinDistance},"bottom hcenter":{top:t.bottom+this.triangleHeight,left:t.left+t.width/2-e/2},"bottom left":{top:t.bottom+this.triangleHeight,left:t.left+t.width/2-this.triangleMinDistance},"bottom right":{top:t.bottom+this.triangleHeight,left:t.right-t.width/2-e+this.triangleMinDistance}}},_adjustElementRect:function(e,n){e.left=t(n.left,n.right-1,e.left),e.right=t(n.left,n.right,e.right),e.top=t(n.top,n.bottom-1,e.top),e.bottom=t(n.top,n.bottom,e.bottom)},_getViewPaneRect:function(t){var e=t.getScrollPosition(),n=t.getViewPaneSize();return{top:e.y,bottom:e.y+n.height,left:e.x,right:e.x+n.width}}},CKEDITOR.event.implementOn(CKEDITOR.ui.balloonPanel.prototype)}();